# vulnerability_29.py
from urllib.parse import urlparse
import requests
import dns.resolver

def scan(url):

    # Your scanning code for Subdomain Takeover
    parsed_url = urlparse(url)
    domain = parsed_url.netloc

    try:
        response = requests.get("http://" + domain)
        if response.status_code == 404:
            # Subdomain does not resolve to an active site
            # Check for takeover opportunities
            
            print("[+] Subdomain Takeover opportunity detected for " + domain)
            
            # Additional logic to identify specific takeover vectors
            # like checking for CNAME records pointing to defunct services
            try:
                cname_records = dns.resolver.resolve(domain, 'CNAME')
                for record in cname_records:
                    if record.target in ['heroku.com', 'github.io']:
                        print("[+] CNAME record points to defunct service: " + record.target)

            except dns.resolver.NoAnswer:
                pass

        else:
            print("[-] Subdomain resolves to an active site")

    except requests.exceptions.ConnectionError:
        print("[-] Error connecting to " + domain)
    
    return f'Subdomain Takeover scan result for {url}'
